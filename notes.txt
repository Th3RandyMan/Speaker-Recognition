import subprocess
import numpy as np

def write_numpy_to_m4a(data, filename, sample_rate):
    # Scale data to int16 range
    scaled_data = (data * 32767).astype(np.int16)

    # Write to raw audio file
    raw_filename = "temp.raw"
    scaled_data.tofile(raw_filename)

    # Convert raw audio to M4A using sox
    subprocess.run(["sox", "-r", str(sample_rate), "-e", "signed-integer", "-b", "16", raw_filename, filename])

    # Clean up temporary raw file
    subprocess.run(["rm", raw_filename])

# Example usage
data = np.random.rand(44100)  # Replace with your actual audio data
write_numpy_to_m4a(data, "output.m4a", sample_rate=44100)
